# üè• Sistema de Gesti√≥n de Turnos M√©dicos - Backend

Backend desarrollado en **NestJS** con **TypeORM** y **MySQL** para la gesti√≥n completa de turnos m√©dicos, incluyendo autenticaci√≥n, autorizaci√≥n basada en roles, y administraci√≥n de pacientes, doctores, especialidades, obras sociales y horarios.

## üìã Tabla de Contenidos

- [Caracter√≠sticas Principales](#-caracter√≠sticas-principales)
- [Tecnolog√≠as](#-tecnolog√≠as)
- [Requisitos Previos](#-requisitos-previos)
- [Instalaci√≥n](#-instalaci√≥n)
- [Configuraci√≥n](#-configuraci√≥n)
- [Base de Datos](#-base-de-datos)
- [Seeders](#-seeders)
- [Sistema de Roles](#-sistema-de-roles)
- [Autenticaci√≥n](#-autenticaci√≥n)
- [Endpoints de la API](#-endpoints-de-la-api)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Scripts Disponibles](#-scripts-disponibles)
- [Soluci√≥n de Problemas](#-soluci√≥n-de-problemas)

---

## ‚ú® Caracter√≠sticas Principales

- üîê **Sistema de autenticaci√≥n JWT** con roles y permisos
- üë• **4 tipos de usuarios**: Admin, Doctor, Secretaria, Paciente
- üìÖ **Gesti√≥n completa de turnos** con estados y confirmaciones
- üè• **Administraci√≥n de doctores** con especialidades
- üë§ **Gesti√≥n de pacientes** con obras sociales
- ‚è∞ **Horarios disponibles** configurables por doctor y consultorio
- üè¢ **Obras sociales** y coberturas
- üö™ **Consultorios** con gesti√≥n de disponibilidad
- ‚úÖ **Validaci√≥n de datos** con class-validator
- üîÑ **Relaciones complejas** entre entidades
- üìä **Base de datos optimizada** con √≠ndices y soft deletes

---

## üõ† Tecnolog√≠as

| Tecnolog√≠a | Versi√≥n | Descripci√≥n |
|------------|---------|-------------|
| **NestJS** | 11.x | Framework de Node.js para backend escalable |
| **TypeORM** | 0.3.x | ORM para TypeScript/JavaScript |
| **MySQL** | 8.0+ | Base de datos relacional |
| **TypeScript** | 5.x | Lenguaje tipado para JavaScript |
| **JWT** | - | JSON Web Tokens para autenticaci√≥n |
| **bcrypt** | - | Encriptaci√≥n de contrase√±as |
| **class-validator** | - | Validaci√≥n de DTOs |

---

## üì¶ Requisitos Previos

Antes de comenzar, aseg√∫rate de tener instalado:

- **Node.js** >= 18.0.0
- **npm** >= 9.0.0 o **yarn** >= 1.22.0
- **MySQL** >= 8.0
- Un editor de c√≥digo (recomendado: VS Code)

---

## üöÄ Instalaci√≥n

### 1Ô∏è‚É£ Clonar el repositorio e instalar dependencias

```bash
# Clonar el repositorio
git clone <url-del-repositorio>
cd be_turnera

# Instalar dependencias
npm install
```

### 2Ô∏è‚É£ Crear la base de datos

La base de datos utiliza **utf8mb4** con collation **utf8mb4_0900_ai_ci** para soporte completo de caracteres Unicode (espa√±ol, emojis, etc.).

#### **Opci√≥n A: Scripts autom√°ticos**

**Windows (PowerShell):**
```powershell
cd src/database
.\create-db.ps1
```

**Windows (CMD):**
```cmd
cd src/database
create-db.bat
```

**Linux/Mac:**
```bash
cd src/database
chmod +x create-db.sh
./create-db.sh
```

#### **Opci√≥n B: MySQL CLI**

```bash
mysql -u root -p < src/database/create-database.sql
```

#### **Opci√≥n C: Comando manual en MySQL**

```sql
-- Conectar a MySQL
mysql -u root -p

-- Ejecutar el script
source src/database/create-database.sql;
```

### 3Ô∏è‚É£ Configurar variables de entorno

```bash
# Copiar el archivo de ejemplo
cp .env.example .env
```

Editar `.env` con tus credenciales:

```env
# Base de datos
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=tu_contrase√±a_mysql
DB_DATABASE=turnera

# Aplicaci√≥n
PORT=3000
NODE_ENV=development

# JWT (cambiar en producci√≥n)
JWT_SECRET=tu_secreto_super_seguro_aqui
JWT_EXPIRATION=24h
```

### 4Ô∏è‚É£ Iniciar la aplicaci√≥n

```bash
# Modo desarrollo (con hot-reload)
npm run start:dev

# La API estar√° disponible en: http://localhost:3000/api
```

---

## ‚öô Configuraci√≥n

### Variables de Entorno

| Variable | Descripci√≥n | Valor por defecto |
|----------|-------------|-------------------|
| `DB_HOST` | Host de MySQL | `localhost` |
| `DB_PORT` | Puerto de MySQL | `3306` |
| `DB_USERNAME` | Usuario de MySQL | `root` |
| `DB_PASSWORD` | Contrase√±a de MySQL | - |
| `DB_DATABASE` | Nombre de la base de datos | `turnera` |
| `PORT` | Puerto de la aplicaci√≥n | `3000` |
| `JWT_SECRET` | Secreto para JWT | - |
| `JWT_EXPIRATION` | Tiempo de expiraci√≥n del token | `24h` |

---

## üóÑ Base de Datos

### Configuraci√≥n

- **Charset:** `utf8mb4`
- **Collation:** `utf8mb4_0900_ai_ci` (MySQL 8.0+)

Esta configuraci√≥n garantiza:
- ‚úÖ Soporte de caracteres especiales del espa√±ol (√±, √°, √©, √≠, √≥, √∫, √º)
- ‚úÖ Soporte de emojis y caracteres Unicode completos
- ‚úÖ B√∫squedas case-insensitive
- ‚úÖ B√∫squedas accent-insensitive

### Estructura de Tablas

El proyecto incluye las siguientes tablas principales:

1. **usuario** - Usuarios del sistema con roles
2. **doctor** - Informaci√≥n de doctores
3. **paciente** - Informaci√≥n de pacientes
4. **turno** - Turnos m√©dicos
5. **especialidad** - Especialidades m√©dicas
6. **obra_social** - Obras sociales
7. **cobertura** - Tipos de cobertura
8. **consultorio** - Consultorios disponibles
9. **horario_disponible** - Horarios de atenci√≥n
10. **doctor_especialidad** - Relaci√≥n muchos a muchos entre doctores y especialidades

### Verificar configuraci√≥n

```sql
-- Ver configuraci√≥n de la base de datos
SELECT 
    DEFAULT_CHARACTER_SET_NAME, 
    DEFAULT_COLLATION_NAME 
FROM INFORMATION_SCHEMA.SCHEMATA 
WHERE SCHEMA_NAME = 'turnera';

-- Ver configuraci√≥n de tablas
SELECT 
    TABLE_NAME, 
    TABLE_COLLATION 
FROM INFORMATION_SCHEMA.TABLES 
WHERE TABLE_SCHEMA = 'turnera';
```

---

## üå± Seeders

Los seeders crean datos iniciales para probar la aplicaci√≥n. Se ejecutan **una sola vez** despu√©s de crear la base de datos.

### Ejecutar Seeders

```bash
npm run seed
```

### Usuarios Creados

El seeder crea 4 usuarios de prueba, uno por cada rol:

| Email | Password | Rol | ID Referencia |
|-------|----------|-----|---------------|
| `admin@turnera.com` | `123456` | **ADMIN** | - |
| `doctor@turnera.com` | `123456` | **DOCTOR** | `1` (id_doctor) |
| `secretaria@turnera.com` | `123456` | **SECRETARIA** | - |
| `paciente@turnera.com` | `123456` | **PACIENTE** | `12345678` (DNI) |

**Nota:** Estos usuarios son solo para desarrollo. Cambiar las contrase√±as en producci√≥n.

### Datos adicionales creados:

- ‚úÖ Especialidades m√©dicas (Cardiolog√≠a, Pediatr√≠a, Traumatolog√≠a, etc.)
- ‚úÖ Consultorios (Consultorio 1, 2, 3, etc.)
- ‚úÖ Obras sociales y coberturas

---

## üë• Sistema de Roles

El sistema implementa **4 roles** con diferentes niveles de acceso:

### üî¥ ADMIN - Administrador del Sistema

Control total sobre el sistema:

- ‚úÖ Crear, modificar y eliminar **pacientes**
- ‚úÖ Crear, modificar y eliminar **doctores**
- ‚úÖ Ver **todos los turnos** del sistema
- ‚úÖ Crear, modificar, confirmar, cancelar y completar **turnos**
- ‚úÖ **Eliminar turnos**
- ‚úÖ Gestionar **obras sociales, consultorios, especialidades**
- ‚úÖ Gestionar **horarios disponibles**

### üü¢ DOCTOR - M√©dico

Permisos orientados a la gesti√≥n de pacientes y turnos propios:

- ‚úÖ Crear y modificar **pacientes**
- ‚úÖ Ver **solo sus propios turnos** (`/turnos/mis-turnos`)
- ‚úÖ Ver turnos por fecha
- ‚úÖ Confirmar, cancelar y completar **turnos**
- ‚úÖ Ver informaci√≥n de **otros doctores**
- ‚ùå No puede eliminar turnos
- ‚ùå No puede ver turnos de otros doctores

### üü° SECRETARIA - Recepcionista/Administradora

Permisos para gesti√≥n administrativa completa:

- ‚úÖ Crear y modificar **pacientes**
- ‚úÖ Crear y modificar **doctores**
- ‚úÖ Ver **todos los turnos** del sistema
- ‚úÖ Crear **turnos**
- ‚úÖ Actualizar, confirmar y cancelar **turnos**
- ‚úÖ **Eliminar turnos**
- ‚úÖ Gestionar **obras sociales y consultorios**
- ‚ùå No puede eliminar doctores (solo ADMIN)

### üîµ PACIENTE - Usuario Final

Permisos limitados a informaci√≥n propia:

- ‚úÖ Ver **solo sus propios turnos** (`/turnos/mis-turnos`)
- ‚úÖ Crear **turnos** para s√≠ mismo
- ‚úÖ Cancelar **sus propios turnos**
- ‚úÖ Ver detalles de **sus turnos**
- ‚ùå No puede ver turnos de otros pacientes
- ‚ùå No puede modificar datos de pacientes
- ‚ùå No puede ver informaci√≥n de doctores completa

---

## üîê Autenticaci√≥n

La API usa **JWT (JSON Web Tokens)** para autenticaci√≥n.

### 1. Registrar un usuario

```bash
POST /api/auth/register
Content-Type: application/json

{
  "email": "nuevo@example.com",
  "password": "password123",
  "nombre": "Juan P√©rez",
  "rol": "paciente",
  "idReferencia": "87654321"  // DNI del paciente o ID del doctor
}
```

**Respuesta:**
```json
{
  "idUsuario": 5,
  "email": "nuevo@example.com",
  "nombre": "Juan P√©rez",
  "rol": "paciente",
  "idReferencia": "87654321",
  "activo": true,
  "fechaCreacion": "2025-10-18T12:00:00.000Z"
}
```

### 2. Iniciar sesi√≥n

```bash
POST /api/auth/login
Content-Type: application/json

{
  "email": "admin@turnera.com",
  "password": "123456"
}
```

**Respuesta:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "idUsuario": 1,
    "email": "admin@turnera.com",
    "nombre": "Admin Sistema",
    "rol": "admin",
    "idReferencia": null
  }
}
```

### 3. Usar el token

Incluir el token en el header `Authorization` de todas las peticiones:

```bash
GET /api/turnos
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 4. Ver perfil del usuario autenticado

```bash
GET /api/auth/profile
Authorization: Bearer <tu_token>
```

---

## üì° Endpoints de la API

Todos los endpoints tienen el prefijo **`/api`**

### üîì P√∫blicos (Sin autenticaci√≥n)

| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| `POST` | `/api/auth/register` | Registrar nuevo usuario |
| `POST` | `/api/auth/login` | Iniciar sesi√≥n |

### üîí Protegidos (Requieren autenticaci√≥n)

#### Perfil de Usuario

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `GET` | `/api/auth/profile` | Todos | Obtener perfil del usuario autenticado |

#### Turnos

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/turnos` | Admin, Secretaria, Paciente | Crear turno |
| `GET` | `/api/turnos` | Admin, Secretaria | Ver todos los turnos |
| `GET` | `/api/turnos/mis-turnos` | Doctor, Paciente | Ver mis propios turnos |
| `GET` | `/api/turnos/:id` | Admin, Secretaria, Doctor, Paciente | Ver un turno espec√≠fico |
| `GET` | `/api/turnos/paciente/:dni` | Admin, Secretaria | Turnos de un paciente |
| `GET` | `/api/turnos/doctor/:id` | Admin, Secretaria, Doctor | Turnos de un doctor |
| `GET` | `/api/turnos/estado/:estado` | Admin, Secretaria, Doctor | Turnos por estado |
| `GET` | `/api/turnos/fecha?fecha=YYYY-MM-DD` | Admin, Secretaria, Doctor | Turnos por fecha |
| `PATCH` | `/api/turnos/:id` | Admin, Secretaria | Actualizar turno |
| `PATCH` | `/api/turnos/:id/confirmar` | Admin, Secretaria, Doctor | Confirmar turno |
| `PATCH` | `/api/turnos/:id/cancelar` | Admin, Secretaria, Paciente, Doctor | Cancelar turno |
| `PATCH` | `/api/turnos/:id/completar` | Admin, Secretaria, Doctor | Completar turno |
| `DELETE` | `/api/turnos/:id` | Admin, Secretaria | Eliminar turno |

#### Pacientes

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/pacientes` | Admin, Doctor, Secretaria | Crear paciente |
| `GET` | `/api/pacientes` | Admin, Doctor, Secretaria | Listar todos |
| `GET` | `/api/pacientes/activos` | Admin, Doctor, Secretaria | Listar activos |
| `GET` | `/api/pacientes/:dni` | Admin, Doctor, Secretaria | Obtener por DNI |
| `PATCH` | `/api/pacientes/:dni` | Admin, Doctor, Secretaria | Actualizar paciente |
| `DELETE` | `/api/pacientes/:dni` | Admin | Eliminar paciente |

#### Doctores

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/doctores` | Admin, Secretaria | Crear doctor |
| `GET` | `/api/doctores` | Admin, Secretaria, Doctor | Listar todos |
| `GET` | `/api/doctores/activos` | Admin, Secretaria, Doctor | Listar activos |
| `GET` | `/api/doctores/:id` | Admin, Secretaria, Doctor | Obtener por ID |
| `PATCH` | `/api/doctores/:id` | Admin, Secretaria | Actualizar doctor |
| `DELETE` | `/api/doctores/:id` | Admin | Eliminar doctor |

#### Especialidades

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/especialidades` | Admin | Crear especialidad |
| `GET` | `/api/especialidades` | Todos autenticados | Listar todas |
| `GET` | `/api/especialidades/:id` | Todos autenticados | Obtener por ID |
| `PATCH` | `/api/especialidades/:id` | Admin | Actualizar especialidad |
| `DELETE` | `/api/especialidades/:id` | Admin | Eliminar especialidad |

#### Obras Sociales

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/obras-sociales` | Admin, Secretaria | Crear obra social |
| `GET` | `/api/obras-sociales` | Todos autenticados | Listar todas |
| `GET` | `/api/obras-sociales/activas` | Todos autenticados | Listar activas |
| `GET` | `/api/obras-sociales/:codigo` | Todos autenticados | Obtener por c√≥digo |
| `PATCH` | `/api/obras-sociales/:codigo` | Admin, Secretaria | Actualizar |
| `DELETE` | `/api/obras-sociales/:codigo` | Admin | Eliminar |

#### Coberturas

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/coberturas` | Admin | Crear cobertura |
| `GET` | `/api/coberturas` | Todos autenticados | Listar todas |
| `GET` | `/api/coberturas/:id` | Todos autenticados | Obtener por ID |
| `PATCH` | `/api/coberturas/:id` | Admin | Actualizar |
| `DELETE` | `/api/coberturas/:id` | Admin | Eliminar |

#### Consultorios

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/consultorios` | Admin, Secretaria | Crear consultorio |
| `GET` | `/api/consultorios` | Todos autenticados | Listar todos |
| `GET` | `/api/consultorios/activos` | Todos autenticados | Listar activos |
| `GET` | `/api/consultorios/:id` | Todos autenticados | Obtener por ID |
| `PATCH` | `/api/consultorios/:id` | Admin, Secretaria | Actualizar |
| `DELETE` | `/api/consultorios/:id` | Admin | Eliminar |

#### Horarios Disponibles

| M√©todo | Endpoint | Roles | Descripci√≥n |
|--------|----------|-------|-------------|
| `POST` | `/api/horarios-disponibles` | Admin, Secretaria | Crear horario |
| `GET` | `/api/horarios-disponibles` | Todos autenticados | Listar todos |
| `GET` | `/api/horarios-disponibles/doctor/:id` | Todos autenticados | Por doctor |
| `GET` | `/api/horarios-disponibles/consultorio/:id` | Todos autenticados | Por consultorio |
| `GET` | `/api/horarios-disponibles/dia?dia=lunes` | Todos autenticados | Por d√≠a |
| `GET` | `/api/horarios-disponibles/:id` | Todos autenticados | Obtener por ID |
| `PATCH` | `/api/horarios-disponibles/:id` | Admin, Secretaria | Actualizar |
| `DELETE` | `/api/horarios-disponibles/:id` | Admin | Eliminar |

### Ejemplos de Uso con cURL

#### Iniciar sesi√≥n

```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@turnera.com",
    "password": "123456"
  }'
```

#### Crear un paciente (como Admin)

```bash
curl -X POST http://localhost:3000/api/pacientes \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <tu_token>" \
  -d '{
    "dniPaciente": "12345678",
    "nombre": "Juan",
    "apellido": "P√©rez",
    "fechaNacimiento": "1990-05-15",
    "direccion": "Calle Falsa 123",
    "telefono": "1234567890",
    "email": "juan@example.com",
    "idObraSocial": "OS001",
    "numeroAfiliado": "12345",
    "idCobertura": 1
  }'
```

#### Ver mis turnos (como Doctor o Paciente)

```bash
curl -X GET http://localhost:3000/api/turnos/mis-turnos \
  -H "Authorization: Bearer <tu_token>"
```

---

## üìÅ Estructura del Proyecto

```
be_turnera/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ auth/                           # M√≥dulo de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decorators/                 # Decoradores personalizados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get-user.decorator.ts   # Obtener usuario del request
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles.decorator.ts      # Decorador de roles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                        # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/                     # Guards de NestJS
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt-auth.guard.ts       # Guard de autenticaci√≥n JWT
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles.guard.ts          # Guard de autorizaci√≥n por roles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ strategies/                 # Estrategias de Passport
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jwt.strategy.ts         # Estrategia JWT
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.module.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ entities/                       # Entidades TypeORM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cobertura.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultorio.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ doctor.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ especialidad.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ horario-disponible.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ obra-social.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ paciente.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ turno.entity.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuario.entity.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ modules/                        # M√≥dulos de funcionalidad
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cobertura/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cobertura.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cobertura.module.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cobertura.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultorio/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ doctor/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ especialidad/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ horario-disponible/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ obra-social/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ paciente/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ turno/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/                       # Scripts de base de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seeds/                      # Seeders
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultorio.seeder.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ especialidad.seeder.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuario.seeder.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seed-all.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-database.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-db.bat
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-db.ps1
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create-db.sh
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ common/                         # Utilidades comunes
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts                   # M√≥dulo ra√≠z
‚îÇ   ‚îî‚îÄ‚îÄ main.ts                         # Punto de entrada
‚îÇ
‚îú‚îÄ‚îÄ .env                                # Variables de entorno (no incluir en git)
‚îú‚îÄ‚îÄ .env.example                        # Ejemplo de variables
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ nest-cli.json
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

---

## üìú Scripts Disponibles

```bash
# Desarrollo
npm run start:dev          # Iniciar en modo desarrollo (hot-reload)
npm run start:debug        # Iniciar en modo debug

# Producci√≥n
npm run build              # Compilar el proyecto
npm run start:prod         # Iniciar en modo producci√≥n

# Base de datos
npm run seed               # Ejecutar seeders (crear datos iniciales)

# Calidad de c√≥digo
npm run lint               # Ejecutar ESLint
npm run format             # Formatear c√≥digo con Prettier

# Testing
npm run test               # Ejecutar tests
npm run test:watch         # Ejecutar tests en modo watch
npm run test:cov           # Ejecutar tests con cobertura
npm run test:e2e           # Ejecutar tests end-to-end
```

---

## üîß Soluci√≥n de Problemas

### ‚ùå Error: `ER_NOT_SUPPORTED_AUTH_MODE`

**Problema:** MySQL est√° usando un m√©todo de autenticaci√≥n no compatible.

**Soluci√≥n:**

```sql
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'tu_contrase√±a';
FLUSH PRIVILEGES;
```

### ‚ùå Error: Puerto 3000 ya est√° en uso

**Soluci√≥n:** Cambiar el puerto en `.env`:

```env
PORT=3001
```

### ‚ùå Error: No se puede conectar a MySQL

**Verificar que MySQL est√© corriendo:**

```bash
# Windows
services.msc    # Buscar "MySQL" y verificar que est√© iniciado

# Linux
sudo systemctl status mysql

# Mac
brew services list
```

### ‚ùå Error: Charset incorrecto

**Verificar configuraci√≥n:**

```sql
SHOW VARIABLES LIKE 'character_set%';
SHOW VARIABLES LIKE 'collation%';
```

### ‚ùå Error 401: Unauthorized

**Posibles causas:**
1. Token expirado ‚Üí Iniciar sesi√≥n nuevamente
2. Token inv√°lido ‚Üí Verificar que el token est√© bien copiado
3. Usuario inactivo ‚Üí Verificar que `activo = true` en la base de datos

### ‚ùå Error 403: Forbidden

**Causa:** No tienes permisos para acceder a ese recurso.

**Soluci√≥n:** Verificar que tu rol tenga acceso al endpoint solicitado (ver [Sistema de Roles](#-sistema-de-roles)).

---

## üìù Notas Importantes

- ‚ö†Ô∏è **Seguridad:** Cambiar `JWT_SECRET` en producci√≥n por un valor seguro y aleatorio
- ‚ö†Ô∏è **Contrase√±as:** Los usuarios de prueba del seeder tienen contrase√±as d√©biles (`123456`). Cambiarlas en producci√≥n.
- ‚ö†Ô∏è **CORS:** Est√° habilitado para desarrollo. Configurar apropiadamente en producci√≥n.
- ‚ö†Ô∏è **TypeORM Sync:** La opci√≥n `synchronize` est√° en `false` para evitar cambios autom√°ticos en producci√≥n
- ‚úÖ **Soft Deletes:** Las entidades principales usan soft deletes (campo `activo`)
- ‚úÖ **Validaci√≥n:** Todos los DTOs tienen validaci√≥n autom√°tica
- ‚úÖ **Timestamps:** Todas las entidades tienen timestamps autom√°ticos
- üìù **API Prefix:** Todos los endpoints tienen el prefijo `/api`

---

## üìñ Documentaci√≥n Adicional

### Flujo de Trabajo T√≠pico

1. **Iniciar sesi√≥n** con un usuario de prueba
2. **Obtener el token JWT** de la respuesta
3. **Incluir el token** en el header `Authorization` de cada petici√≥n
4. **Realizar operaciones** seg√∫n los permisos del rol

### Estados de Turnos

Los turnos pueden tener los siguientes estados:

- `pendiente` - Turno creado, esperando confirmaci√≥n
- `confirmado` - Turno confirmado por secretaria o doctor
- `completado` - Turno realizado
- `cancelado` - Turno cancelado

### D√≠as de la semana (para horarios)

- `lunes`
- `martes`
- `mi√©rcoles`
- `jueves`
- `viernes`
- `s√°bado`
- `domingo`

---

## ü§ù Contribuir

Si deseas contribuir al proyecto:

1. Fork el repositorio
2. Crea una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit tus cambios (`git commit -m 'Agregar nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Abre un Pull Request

---

## üìÑ Licencia

UNLICENSED - Este proyecto es privado.

---

## üë®‚Äçüíª Autor

Desarrollado con ‚ù§Ô∏è para la gesti√≥n eficiente de turnos m√©dicos.

---

## üìû Soporte

Si tienes problemas o preguntas:

1. Revisa la secci√≥n [Soluci√≥n de Problemas](#-soluci√≥n-de-problemas)
2. Verifica que todos los pasos de [Instalaci√≥n](#-instalaci√≥n) est√©n completos
3. Consulta la [Documentaci√≥n de NestJS](https://docs.nestjs.com/)
4. Consulta la [Documentaci√≥n de TypeORM](https://typeorm.io/)

---

**¬°Gracias por usar el Sistema de Gesti√≥n de Turnos M√©dicos! üè•**
